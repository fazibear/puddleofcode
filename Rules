#!/usr/bin/env ruby

passthrough '/assets/**/*'

layout '/**/*.slim', :slim
layout '/**/*', :erb

preprocess do
  add_pagination_for('/story/*', '/stories', 12)
end

compile '/**/*.slim' do
  filter :slim

  layout '/default.*'

  write item.identifier.without_ext + '.html'
end

compile /\/stories.*/ do
  layout '/stories.*'

  write item.identifier.without_ext + '/index.html'
end

compile '/story/*.md' do
  filter :pandoc, from: :gfm, to: :html

  layout '/story.*'

  write item.identifier.without_ext + '/index.html'
end

compile '/project/*.md' do
  filter :pandoc, from: :gfm, to: :html

  layout '/project.*'

  write item.identifier.without_ext + '/index.html'
end

compile '/til/*.md' do
  filter :pandoc, from: :gfm, to: :html

  layout '/til.*'

  write item.identifier.without_ext + '/index.html'
end

compile '/**/*' do
  p "ups! #{item.identifier}"
end
